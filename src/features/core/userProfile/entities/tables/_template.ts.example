// src/features/core/userProfile/entities/tables/xxxProfile.ts
// このファイルはプロフィールテーブル定義のテンプレートです。
// 新しいロール用プロフィールを追加する際にコピーして使用してください。
//
// 元情報: src/config/app/roles.config.ts > xxx.profileFields
// 将来的には roles.config.ts から自動生成される予定
//
// 手順:
// 1. roles.config.ts でロールを定義（hasProfile: true, profileFields: [...]）
// 2. このテンプレートをコピーしてテーブル定義を作成
// 3. entities/drizzle.ts で re-export
// 4. services/server/bases/ に xxxProfileBase.ts を作成
// 5. services/server/registry.ts に登録
// 6. drizzle-kit push でDBスキーマを更新

import { UserTable } from "@/features/core/user/entities/drizzle";
import { boolean, pgTable, text, timestamp, uuid } from "drizzle-orm/pg-core";

/**
 * プロフィールテーブル定義
 *
 * @source roles.config.ts > xxx.profileFields
 */
export const XxxProfileTable = pgTable("xxx_profiles", {
  // ==========================================================================
  // システムフィールド（全プロフィールテーブル共通、profileFieldsに含めない）
  // ==========================================================================
  /** 主キー */
  id: uuid("id").primaryKey().defaultRandom(),
  /** UserTable.id への外部キー（1:1、unique制約で担保） */
  userId: uuid("user_id")
    .notNull()
    .unique()
    .references(() => UserTable.id, { onDelete: "cascade" }),

  // ==========================================================================
  // プロフィールフィールド
  // @source roles.config.ts > xxx.profileFields
  // - ユーザー編集可能フィールド: formInput で適切な入力タイプを指定
  // - 管理者専用フィールド: formInput: "hidden" を指定
  // - 承認ワークフロー: isApproved + approvedAt + approvalNote
  //   - approvedAt = null → 未審査
  //   - isApproved = true, approvedAt = timestamp → 承認済み
  //   - isApproved = false, approvedAt = timestamp → 非承認
  // ==========================================================================
  // companyName: text("company_name"),
  // contactPhone: text("contact_phone"),
  // isApproved: boolean("is_approved").default(false).notNull(),
  // approvedAt: timestamp("approved_at", { withTimezone: true }),
  // approvalNote: text("approval_note"),

  // ==========================================================================
  // タイムスタンプ（全プロフィールテーブル共通、profileFieldsに含めない）
  // ==========================================================================
  createdAt: timestamp("created_at", { withTimezone: true }).defaultNow(),
  updatedAt: timestamp("updated_at", { withTimezone: true }).defaultNow(),
});

export type XxxProfile = typeof XxxProfileTable.$inferSelect;
export type XxxProfileInsert = typeof XxxProfileTable.$inferInsert;
