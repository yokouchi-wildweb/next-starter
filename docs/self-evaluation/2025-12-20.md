# 評価結果: 2025-12-20

## 評価方式
- [x] 二段階評価（俯瞰 + 項目別）

俯瞰評価実施後、同日中に項目別詳細評価を実施。各項目の参照先ファイルを実際に読み、チェックポイントを網羅的に確認した。

---

## サマリー

| 項目 | スコア | 前回比 |
|------|--------|--------|
| 1. テンプレートとしての即時利用性 | B | - |
| 2. レイヤー構造の一貫性（縦方向） | A | - |
| 3. ドメイン境界の責務分離（横方向） | A | - |
| 4. 拡張性・カスタマイズ性 | B | - |
| 5. コアライブラリの品質 | A | - |
| 6. ドキュメントの充実度 | A | - |
| 7. セキュリティ | B | - |
| 8. 派生リポジトリへの配慮 | C | - |
| 9. テスト・品質保証 | E | - |

**総合評価**: B（実用可）

- A評価: 4項目（レイヤー構造一貫性、ドメイン境界分離、コアライブラリ品質、ドキュメント充実度）
- B評価: 3項目（即時利用性、拡張性・カスタマイズ性、セキュリティ）
- C評価: 1項目（派生リポジトリへの配慮）
- E評価: 1項目（テスト・品質保証）

---

## 詳細評価

### 1. テンプレートとしての即時利用性 [B]

**良い点**:
- クイックスタートガイド（204行）が詳細で、環境構築→デプロイまで9ステップで段階的に説明
- ドメイン生成ツール（`dc:*`）が7コマンド整備され、対話形式（inquirer）でユーザーフレンドリー
- `.env.example`（31行）が整備され、必要な環境変数を網羅、コメント付き
- `resolveGenerateTargets`で生成オプション（config/manual/all）を柔軟に選択可能

**課題**:
- 外部サービス依存が高い（Firebase + Neon 両方の設定が必須で起動不可）
- domain-config のエラーメッセージが簡素（「設定ファイルが見つかりません」程度）
- 初回セットアップに Firebase/Neon の事前知識が必要

**推奨アクション**:
- [ ] モックモード（外部サービスなしで起動可能なモード）の検討
- [ ] エラー発生時のトラブルシューティングガイドへのリンク追加
- [ ] 環境変数未設定時の起動時エラーメッセージ改善

---

### 2. レイヤー構造の一貫性（縦方向） [A]

**良い点**:
- 8層レイヤー構造が全ドメインで遵守（components/, hooks/, services/client/, services/server/, entities/）
- 命名規則が統一（ファイル名: camelCase、フック: useCamelCase、コンポーネント: PascalCase）
- HTTPクライアントポリシー厳守（`createApiClient`でaxios統一、fetch使用ゼロ）
- DBアクセスがServer Service経由で統一（`withDomainService` + `serviceRegistry`パターン）
- レイヤー間依存が正しい（フック→クライアントサービス→API→サーバーサービス→エンティティ）

**課題**:
- coreドメインのサブドメインに`domain.json`がない（手動管理のため）
- 軽微: オプションディレクトリ（constants/, types/）の使用基準が未ドキュメント化

**推奨アクション**:
- [ ] coreドメインの手動管理ポリシーをドキュメント化
- [ ] オプションディレクトリ（constants/, types/）の使用基準を明記

---

### 3. ドメイン境界の責務分離（横方向） [A]

**良い点**:
- ドメイン間依存が適切（sample→sampleCategory/sampleTagはリレーション定義のみ）
- 各ドメインが単一責任（sample: データ管理、sampleCategory: カテゴリ、sampleTag: タグ）
- 共有ロジックが適切に配置（`src/lib/`に15モジュール、`src/features/core/`にシステム機能）
- ドメイン固有エンティティの他ドメインからの直接参照なし（drizzle.tsリレーション定義除く）
- ドメイン間通信がフック経由（`useSampleCategoryList`等）

**課題**:
- 特になし

**推奨アクション**:
- （なし）

---

### 4. 拡張性・カスタマイズ性 [B]

**良い点**:
- 新規ドメイン追加ワークフローが確立（`アプリへの新規ドメイン追加ガイド.md` 113行）
- domain.jsonが充実（フィールド定義、リレーション、フォーム入力種別、検索設定）
- `generateFiles`で生成対象を細かく制御可能（entities/components/hooks等）
- wrappers/による拡張パターンが確立（drizzleBase.tsを安全に拡張）
- 変更禁止領域がCLAUDE.md「System Core Files」で明示

**課題**:
- 生成コードと手動編集の共存ルールが弱い（再生成で上書きされるファイル一覧がない）
- `_template/`ディレクトリの使用方法ドキュメントが薄い

**推奨アクション**:
- [ ] 再生成で上書きされるファイル一覧をドキュメント化
- [ ] 「手動編集可能ファイル」と「自動生成のみファイル」を明確に区分
- [ ] `_template/`ディレクトリの使用方法を追記

---

### 5. コアライブラリの品質 [A]

**良い点**:
- `src/lib/`に15モジュール（crud/, errors/, firebase/, storage/, mail/, tableSuite/等）
- `src/lib/crud/`が特に充実（30ファイル以上、drizzle/, firestore/, hooks/サブディレクトリ）
- 共通コンポーネント（`src/components/README.md` 104行）で10カテゴリを詳細解説
- エラーハンドリング統一（`HttpError`, `DomainError`, `normalizeHttpError()`, `err()`）
- CRUDシステム高機能（search, upsert, bulkDelete, duplicate, restore, hardDelete, belongsToMany）
- 型定義充実（`ApiClient<T, CreateData, UpdateData>`, `WhereExpr`, `OrderBySpec`）

**課題**:
- `src/lib/README.md`がなく、各モジュールの役割一覧がない

**推奨アクション**:
- [ ] `src/lib/README.md`を作成し、各モジュールの役割を一覧化

---

### 6. ドキュメントの充実度 [A]

**良い点**:
- CLAUDE.mdが400行超の詳細なガイダンス（アーキテクチャ、レイヤー構造、禁止事項、命名規則）
- docs/に45ファイルのドキュメント、`docs/README.md`（58行）がインデックスとして機能
- `!must-read/`で必読6ドキュメントを明示（構成層、コンポーネント設計、エラーハンドリング等）
- カテゴリ分けが明確（concepts/, how-to/, core-specs/, reference/, troubleshooting/）
- コード内コメントも日本語で適切に配置

**課題**:
- トラブルシューティングガイドが3件と少なめ

**推奨アクション**:
- [ ] 開発中に発生した問題をトラブルシューティングに追記する運用ルール策定

---

### 7. セキュリティ [B]

**良い点**:
- 全9ドメインでZodスキーマによる入力バリデーション
- Drizzle ORMによるパラメータ化クエリ（SQLインジェクション対策）
- 認証システムが充実（`core/auth/`に69ファイル、OAuth対応、Firebase Auth統合）
- Cookie設定が適切（`sameSite: "lax"`, `httpOnly: true`, `secure: true`）
- エラーメッセージで内部情報が漏洩しない（`DomainError`でユーザー向けメッセージ制御）

**課題**:
- `npm audit`で複数の脆弱性検出:
  - `esbuild`: moderate（開発サーバー関連）
  - `jws 4.0.0`: high（HMAC署名検証の不備）
  - `next 16.0.x`: high（サーバーアクション/DoS）

**推奨アクション**:
- [ ] Next.js 16.xの脆弱性パッチ適用を監視、リリース後に更新
- [ ] `jws`パッケージの更新（`npm audit fix`で対応可能）
- [ ] 定期的な`npm audit`の実行をCIに組み込み

---

### 8. 派生リポジトリへの配慮 [C]

**良い点**:
- ドメイン分離設計で競合しにくい構造（features/配下が独立）
- 変更禁止領域がCLAUDE.md「System Core Files」で明示（5ディレクトリ）
- テンプレート利用ガイド（79行）が存在

**課題**:
- 派生リポジトリ作成時のガイドラインが不十分（フォーク手順、初期設定の具体的手順がない）
- 上流変更のマージ方法の説明がない
- ベース固有と案件固有の設定分離が曖昧（明確なファイル一覧やマーキングなし）

**推奨アクション**:
- [ ] 派生リポジトリ作成ガイド（フォーク手順、初期設定）を作成
- [ ] 上流変更のマージ手順をドキュメント化
- [ ] ベース固有ファイルと案件カスタマイズファイルの一覧を作成

---

### 9. テスト・品質保証 [E]

**良い点**:
- Playwright が devDependencies に含まれている（`@playwright/test`）

**課題**:
- ユニットテストが存在しない（`__tests__/`なし、`*.test.ts`なし）
- E2Eテストの基盤が未整備（`playwright.config.ts`なし）
- CI/CDパイプラインが未設定（`.github/workflows/`なし）
- テスト実行方法がドキュメント化されていない（`test`スクリプトなし）
- 品質を担保するためのレビュー観点が未整備

**推奨アクション**:
- [ ] ユニットテストのサンプルを作成（CRUDサービスの基本テストなど）
- [ ] `playwright.config.ts`を追加し、E2Eテストのサンプルを作成
- [ ] GitHub Actionsでlint + build + testのCIパイプラインを構築
- [ ] テスト実行方法をドキュメント化

---

## 俯瞰評価との乖離

項目別評価は俯瞰評価と同日に実施したため、スコアの乖離はなし。
ただし、以下の詳細が項目別評価で明確化された：

- **項目7（セキュリティ）**: `npm audit`で具体的な脆弱性（jws high, next 16.x high）を特定
- **項目3（ドメイン境界分離）**: 俯瞰評価では「アーキテクチャ一貫性」として評価していたが、評価設定に基づき縦横分離で評価

---

## 次回評価への申し送り

- 初回評価のため、前回比較なし
- **最優先課題**: テスト・品質保証（E評価）の改善
  - まずはCIパイプライン構築とユニットテストサンプル作成から着手推奨
- **次点課題**: 派生リポジトリへの配慮（C評価）の改善
  - フォーク手順と上流マージガイドの整備
- **セキュリティ**: Next.js 16.xとjwsパッケージの脆弱性対応を監視
