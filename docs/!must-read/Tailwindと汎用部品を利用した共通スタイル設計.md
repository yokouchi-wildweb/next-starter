# Tailwindと汎用部品を利用した共通スタイル設計

## 🎯 目的

このガイドラインは、Tailwind CSS v4 のユーティリティと `src/components` 配下の汎用コンポーネントを組み合わせて、アプリ全体のスタイルを一貫して設計・運用するための判断軸を整理したものです。以下の観点で活用してください。

- 汎用コンポーネントのバリアントやレイアウト機能を優先し、**生の HTML や個別クラス指定に依存しない**スタイリングフローを定着させる
- Tailwind の `@layer` / `@theme` と汎用コンポーネントの責務を切り分け、双方を横断したスタイル拡張の手順を明確にする
- 新規スタイルの追加・既存スタイルの改修時に、どのレイヤー／コンポーネントを更新すべきか素早く判断できるようにする

---

## 🧭 全体的なスタイル運用ガイド

> 🚫 クラス名ベースのスタイリングは最終手段

> ⚠️ 生のHTMLではなく汎用コンポーネントを使用


- **クラス名を直接付与してスタイリングする行為は極力避けます。** 既存の汎用コンポーネントやそのバリアントで表現できないかを必ず確認してください。
- 基本的には `src/components` 配下に存在するコンポーネントとそのバリアントを利用してスタイルを構築します。Shadcn ベースのラッパーや `cva` で定義されたバリアントを優先的に採用します。
- `src/components/README.md` を参照しながら、用途に合ったラッパーを選択してください。
- 特に下記フォルダは使用頻度が高い部品が用意されているので要確認
  - `Layout`（レイアウト用のdivなど）
  - `TextBlocks`（p,sectionなど文章構成用）
  - `Form`（ボタンなどフォーム部品）
- 既存のコンポーネントで対応できない場合は、新たなラッパーコンポーネントやバリアントを追加して再利用性を高めます。その際はドキュメントや props の整理も合わせて実施します。

| 従来の要素・使用意図           | 使用すべきコンポーネント                                                                   | 説明                                                                           |
|----------------------|--------------------------------------------------------------------------------|------------------------------------------------------------------------------|
| 余白調整などレイアウト用の div    | `src/components/Layout` の要素<br />`src/components/TextBlocks/Para.tsx`          | デフォルトで適度なマージンを保持している。`Block`, `Flex` は子要素の余白調整も可能。                           |
| エラー、補足などテキストの見た目を変える | `src/components/TextBlocks/Para.tsx`<br />`src/components/TextBlocks/Span.tsx` | バリアントでテキスト色やサイズを変更可能。                                                        |
| 従来の button 要素の使用箇所   | `src/components/Form/Button.tsx`                                               | 多様なバリアントが用意されている。                                                            |
| セマンティックな文章構造を作成したい   | `src/components/Form/TextBlocks` の要素                                           | `Section` は adide, articleなど各種セクショニング要素として使用可能。 hx要素に相当する `SecTItle` なども活用する |



---

## 🧩 汎用コンポーネントの利用ルール

- プロジェクトには Shadcn が導入されており、`src/components/Shadcn/` 配下に土台となるコンポーネントが配置されています。汎用コンポーネントはこれらをラップする形で用意されているため、まずは既存のラッパーを優先して利用します。
- 適切なラッパーが存在しない場合は、新たにラップコンポーネントを作成するか、Shadcn のコンポーネントを直接利用して構いません。いずれの場合も再利用前提の props 設計を心がけてください。
- 各汎用コンポーネントはバリアントやサイズなどのプロップを軸にスタイリングできるように設計し、**使用箇所でクラス名ベースのスタイリングに依存することは禁止します。** 必要なバリアントがなければ追加してから利用してください。

---

## 📁 cssファイルのディレクトリ構成

Tailwind と汎用コンポーネントによるスタイル適用が基本ですが、以下のようなケースでは CSS ファイルの編集が必要になります。

- 汎用コンポーネントや既存バリアントへロジックを追加しても解決できない横断的なデザイントークンを定義したいとき。
- アニメーション・初期化スタイルなど、Tailwind のユーティリティでは表現しづらい全体適用のルールを整備するとき。
- 複数画面で共通利用する UI パターンを `@layer components` でまとめ、Tailwind クラスだけでは管理が難しいとき。
- Tailwind のユーティリティでは表現が難しい微細なユースケースに対して、再利用性を担保したユーティリティクラスを追加したいとき。

```
src/styles/
├─ global.css       # Tailwind の読み込み窓口（CSS は書かない）
├─ theme.css        # デザイントークン（色 / フォント / 変数など）
├─ animations.css   # 共通アニメーションと --animate-* の宣言
├─ base.css         # @layer base 用の初期化スタイル
├─ components.css   # @layer components 用の共通 UI
├─ utilities.css    # @layer utilities 用の小さなユーティリティ
└─ admin.css        # 管理画面専用スタイル（@layer components 利用）
```

---

## 📚 役割サマリー

| ファイル | 役割 | 主な内容 |
| -------- | ---- | -------- |
| `global.css` | Tailwind エントリーポイント | `@import "tailwindcss"` と各スタイルファイルの読み込みのみを記述します。CSS ルールは書きません。 |
| `theme.css` | デザイントークンの定義 | `@theme inline` でカラー・フォント・spacing などの値を宣言します。必要に応じて `:root` / `.dark` で CSS カスタムプロパティも定義します。 |
| `animations.css` | 共通アニメーション | `@theme` と `@keyframes` を組み合わせてアニメーションを登録し、`--animate-*` で使用宣言します。 |
| `base.css` | 全体へ適用する初期化 | body の背景色・フォーム部品のリセットなど、アプリ全体で共有するスタイルを `@layer base` に記述します。 |
| `components.css` | 共通 UI パターン | `.badge` など複数ページで再利用するスタイルを `@layer components` にまとめます。 |
| `utilities.css` | 小さなユーティリティ | `.pill-tag` のように単体で使える補助クラスを `@layer utilities` に定義します。 |
| `admin.css` | 管理画面向け追加 | 管理画面特有のスタイルを `@layer components` で拡張し、他画面への影響を避けます。 |

Tailwind は、`theme`・`animations`・`base` のようにページ全体へ適用する定義と、`components`・`utilities` のように複数箇所での再利用を前提とした定義によって構成されています。これらのレイヤーを活用することで、汎用化されたスタイルを中心に据えた運用が可能になります。

独自デザインが多くバリアント化が難しい場合や、個別クラス名が増えすぎる場合は、新たな CSS ファイルを作成し `@layer components` にスタイルを記述することを検討してください。その際もコンポーネントやバリアントへの還元を優先し、共通化の可能性を常に探ります。

---

## 🔁 `@import` のルール

- **`@import "tailwindcss"` は `global.css` の 1 箇所にだけ記述します。**
  - Tailwind v4 では複数回インポートするとビルドコストが増えたり、未使用クラスのツリーシェイクが効かなくなる可能性があります。
- その他の CSS ファイルは `global.css` 経由で読み込まれる前提のため、個別に Tailwind をインポートする必要はありません。
- 外部プラグイン（`tw-animate-css` など）を追加する場合も `global.css` でまとめて import してください。

---

## 🧱 ファイル別の運用ポイント

### `theme.css`
- `@theme inline` で Tailwind のデザイントークンを宣言します。
- `:root` / `.dark` のカスタムプロパティを更新するときは、同じキーを `@theme inline` へも登録し Tailwind クラスとして使えるようにします。
- 新しいカラーやフォントを追加したら、影響範囲の大きい箇所（コンポーネント、ドキュメント）を確認してからコミットしてください。

### `animations.css`
- アニメーションを追加するときは `--animate-*` で使用宣言し、対応する `@keyframes` を同一ファイル内に書きます。
- `@keyframes` 名はケバブケースを推奨します。Tailwind の `animate-[name]` と合わせて使うときは名前を揃えてください。

### `base.css`
- リセットや HTML 要素の基本スタイルのみを記述します。
- ページ固有のスタイルや大きなレイアウトはここに書かないようにし、コンポーネント側で制御してください。

### `components.css`
- 再利用する UI パターンを `@layer components` にまとめます。
- なるべく `@apply` で Tailwind ユーティリティを組み合わせ、直接のプロパティ指定は最小限にします。
- コンポーネントで `cva` を使っている場合は、まずバリアントで表現できないか検討してください。

### `utilities.css`
- Tailwind のユーティリティで表現しづらい 1 プロパティ完結のクラスを置きます。
- `.is-*` や `.has-*` のような状態クラスを追加するときは命名の衝突に注意してください。

### `admin.css`
- 管理画面専用の UI コンポーネントを `@layer components` で追加します。
- フロント（一般ユーザー向け）画面と共通化する場合は `components.css` へ移動することを検討します。

---

## 🛠️ スタイル追加の手順

1. **目的を整理する** – 追加するスタイルがテーマ定義なのか、共通 UI なのか、ユーティリティなのかを判断します。
2. **適切なファイルを選ぶ** – 上記サマリー表とファイル別ポイントを参考に、変更先のファイルを選定します。
3. **`@layer`/`@theme` を守る** – base/components/utilities のどれに当てはまるか確認し、既存のブロック内に追記します。
4. **Tailwind クラスを優先する** – まずはユーティリティクラスや `@apply` の組み合わせで実現できないか確認し、プレーン CSS は最終手段とします。
5. **Story/画面で確認する** – 影響範囲の UI を手動で確認し、必要に応じてスクリーンショットやドキュメントを更新します。
6. **`npm run lint` を実行する** – コード変更後は必ず Lint を実行してスタイル漏れや型エラーを検出します。

---

## 🧭 Tailwind 設定と連携する際の注意

- `components.json` や `tailwind.config` に依存せず、`@theme` で直接トークンを宣言できるのが v4 の特徴です。設定ファイルを変更する前に `theme.css` で解決できないか検討してください。
- 既存ユーティリティを上書きしたい場合は、`@layer base` での上書きと Tailwind クラスの組み合わせを検討し、フルカスタム CSS を最小限に抑えます。
- CSS 変数を使う場合は `theme.css` で変数を定義し、`base.css` やコンポーネントで参照する形にすると保守性が高まります。

---

## 🙋‍♀️ よくある質問

- **Q. グローバルに効かせたい背景色をどこに書く？**
  - A. `base.css` の `@layer base` 内で body に対して記述してください。`global.css` には書きません。
- **Q. 画面固有の追加スタイルはどこに置く？**
  - A. 可能であればコンポーネント単位で Tailwind クラスを直接指定します。どうしても CSS ファイルが必要な場合は該当画面用の CSS ファイルを新規に作成し、`global.css` から import してください。
- **Q. Tailwind のプラグインを追加したい。**
  - A. `postcss.config.mjs` や `tailwind.config` での設定より前に、まず `global.css` で import できるか確認し、チームに影響範囲を共有してください。

---

このガイドラインに沿って運用することで、スタイルの責務分離が明確になり、Tailwind CSS v4 の恩恵を最大限に活かせます。疑問点があればドキュメントを更新し、ナレッジを蓄積していきましょう。
